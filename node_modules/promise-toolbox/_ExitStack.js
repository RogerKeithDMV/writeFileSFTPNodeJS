"use strict";

var Disposable = require("./Disposable");

var isDisposable = require("./_isDisposable");

var pTry = require("./try");

module.exports = function () {
  function ExitStack() {
    var _this = this;

    this._disposers = [];

    var dispose = function dispose() {
      var disposer = _this._disposers.pop();

      return disposer !== undefined ? pTry(disposer).then(dispose) : Promise.resolve();
    };

    return new Disposable(this, dispose);
  }

  var _proto = ExitStack.prototype;

  _proto.enter = function enter(disposable) {
    if (!isDisposable(disposable)) {
      throw new TypeError("not a disposable");
    }

    this._disposers.push(disposable.dispose);

    return disposable.value;
  };

  return ExitStack;
}();